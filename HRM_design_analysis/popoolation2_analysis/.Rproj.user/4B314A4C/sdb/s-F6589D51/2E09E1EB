{
    "contents" : "Inspection of Popoolation Data from Onion BSA RNASEQ Experiment\n========================================================\n\nTry to retrieve using Rcurl\n```{r}\n# library(\"RCurl\", lib.loc=\"C:/Program Files/R/R-3.0.2/library\")\n# all <- scp(\"genome3.pfr.co.nz\",\"/workspace/genome_analysis/plant/Allium/cepa/NXD_sample_align/35.cmh_test_all/All_bolt_assoc.cmh.params\",rsa=TRUE,user=\"cfljam\",key=sprintf(c(\"C:\\\\Program Files (x86)/WinSCP/PuTTY/craptop2013.ppk\")),binary=FALSE )\n```\n\nGave up and scp-ed from \n/workspace/genome_analysis/plant/Allium/cepa/NXD_sample_align/35.cmh_test_all\n\n```{r }\ncolumn_names <-c(\"BoltA1_RG.bam\",\n\"BoltA2_RG.bam\",\n\"BoltA3_RG.bam\",\n\"BoltB1_RG.bam\",\n\"BoltB2_RG.bam\",\n\"BoltB3_RG.bam\",\n\"NonA1_RG.bam\",\n\"NonA2_RG.bam\",\n\"NonA3_RG.bam\",\n\"NonB1_RG.bam\",\n\"NonB2_RG.bam\",\n\"NonB3_RG.bam\")  \n\nall_bolt <- read.table('All_bolt_assoc.cmh',col.names=c(\"chrom\",\"pos\",\"ref_base\",column_names,\"pval\"))\nacp267_LD <- read.table('ACP267_LD.cmh.bz2',col.names=c(\"chrom\",\"pos\",\"ref_base\",column_names,\"pval\"))\nBolt_notACP267 <-read.table('Bolt_notACP267_LD_assoc.cmh.bz2',,col.names=c(\"chrom\",\"pos\",\"ref_base\",column_names,\"pval\"))\n```\nBind together\n```{r}\ncombined <- cbind(all_bolt,acp267_LD$pval,Bolt_notACP267$pval)\n```\nNow plot the pvalues\n```{r}\nlibrary(ggplot2)\nhist_all_pval <- ggplot(all_bolt,aes(x=pval)) + geom_histogram() + ggtitle('all')\nhist_ACP_pval <- ggplot(acp267_LD,aes(x=pval)) + geom_histogram() + ggtitle('ACP267')\nhist_NotACP_pval <- ggplot(Bolt_notACP267,aes(x=pval)) + geom_histogram() + ggtitle('NotACP267')\n\nhist_all_pval\nhist_ACP_pval\nhist_NotACP_pval\n```\nNow estimate FDR \n```{r}\nlibrary(\"qvalue\", lib.loc=\"/Library/Frameworks/R.framework/Versions/3.0/Resources/library\")\nall_qobj <- qvalue(all_bolt$pval)\nacp_qobj <- qvalue(acp267_LD$pval)\nnonACP_qobj  <- qvalue(Bolt_notACP267$pval)\nqplot(all_qobj)\n```\nEstimate p value cutoff for FDR= 0.01\n```{r}\nFDR <- 0.01\nmax(all_qobj$pvalues[all_qobj$qvalues <= FDR])\nmax(acp_qobj$pvalues[acp_qobj$qvalues <= FDR])\nmax(nonACP_qobj$pvalues[nonACP_qobj$qvalues <= FDR])\n```\nUse minimum of these as cutoff\nAll are about 7e-05\n```{r}\npval_cutoff <- max(acp_qobj$pvalues[acp_qobj$qvalues <= FDR])\n```\nGet the **minimum** pvalues by contig\n```{r}\nby_contig <- aggregate(data=combined,cbind(pval,acp267_LD$pval,Bolt_notACP267$pval) ~ chrom,min)\ncolnames(by_contig) <- c(\"chrom\", \"all_pval\",\"ACP267_pval\",\"NotACP267_pval\")\n```\n\n\nNow form a Venn diagram as described at \nhttp://www.ats.ucla.edu/stat/r/faq/venn.htm\n\nForm summary of booleans-contigs with minimum p-value < FDR cutoff  \n```{r Venn}\nby_contig$sig_all <- by_contig$all_pval < max(all_qobj$pvalues[all_qobj$qvalues <= FDR])\nby_contig$sig_acp267 <- by_contig$ACP267_pval < max(acp_qobj$pvalues[acp_qobj$qvalues <= FDR])\nby_contig$sig_nonACP <- by_contig$NotACP267_pval < max(nonACP_qobj$pvalues[nonACP_qobj$qvalues <= FDR])\n\nlibrary(\"limma\", lib.loc=\"/Library/Frameworks/R.framework/Versions/3.0/Resources/library\")\na <- vennCounts(by_contig[5:7])\nvennDiagram(a)\n```\nMake a scatterplot\n```{r Scatterplot of Contig Minimum Pvalues}\nggplot(by_contig,aes(x=-log10(ACP267_pval))) + geom_point(aes(alpha=-log10(all_pval),y=-log10(NotACP267_pval))) + ggtitle('Contig minimum CMH test pvalue')+ coord_fixed()\n\n```\nProducing pdf output using pandoc\n```\npandoc popoolation2_pvalues.md -o popoolation2_pvalues.pdf\n```\n",
    "created" : 1390346155607.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3999424650",
    "id" : "2E09E1EB",
    "lastKnownWriteTime" : 1390445557,
    "path" : "C:/Users/cfljam/Dropbox/FT_genetics_2012/BSA_RNASEQ/analysis/popoolation2_analysis/popoolation2_pvalues.Rmd",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "source_on_save" : false,
    "type" : "r_markdown"
}